import{_ as s,c as a,d as e,o as t}from"./app-2zDOARd1.js";const p={};function i(o,n){return t(),a("div",null,n[0]||(n[0]=[e(`<h1 id="using-inspireface-in-python" tabindex="-1"><a class="header-anchor" href="#using-inspireface-in-python"><span>Using InspireFace in Python</span></a></h1><p>The python version of inspireface is based on ctypes and the standard edition of InspireFaceSDK libraries, and usually requires <strong>python &gt;= 3.7</strong>.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>If you install inspireface from pypi, it is usually a regular version that <strong>only supports the cpu</strong> version. If you want to build python based on CUDA, Rockchip NPU, ANE inference backend, you will need to re-adapt the corresponding version of the library to the Python project. See the repository for <a href="https://github.com/HyperInspire/InspireFace/tree/master/python" target="_blank" rel="noopener noreferrer">more details</a>.</p></div><h2 id="installation-and-setup" tabindex="-1"><a class="header-anchor" href="#installation-and-setup"><span>Installation and Setup</span></a></h2><p>You can use pip to install the InspireFace Python package:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">pip <span class="token function">install</span> <span class="token parameter variable">-U</span> inspireface</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="initialization" tabindex="-1"><a class="header-anchor" href="#initialization"><span>Initialization</span></a></h2><p>Global initialization of InspireFace is necessary. You only need to perform it once when the program starts. The initialization includes functions such as configuration reading and model loading.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># The simplest way - will automatically download and use the Pikachu model</span></span>
<span class="line">isf<span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Or specify a model name</span></span>
<span class="line">isf<span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token string">&quot;Pikachu&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Or use a custom model path</span></span>
<span class="line">isf<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>resource_path<span class="token operator">=</span><span class="token string">&quot;/path/to/your/model&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also check the launch status and terminate when needed:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Check if InspireFace is already launched</span></span>
<span class="line"><span class="token keyword">if</span> isf<span class="token punctuation">.</span>query_launch_status<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;InspireFace is already launched&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Terminate InspireFace (optional, usually not needed)</span></span>
<span class="line">isf<span class="token punctuation">.</span>terminate<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="how-to-switch-models" tabindex="-1"><a class="header-anchor" href="#how-to-switch-models"><span>How to switch models</span></a></h2><p>You can start or restart global initialization with the reload function. You can use model_name to specify the model to use, such as Pikachu or Megatron, or you can use the resource_path parameter to specify a model path.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Will download automatically</span></span>
<span class="line">isf<span class="token punctuation">.</span><span class="token builtin">reload</span><span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token string">&#39;Pikachu&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Direct use path</span></span>
<span class="line">isf<span class="token punctuation">.</span><span class="token builtin">reload</span><span class="token punctuation">(</span>model_name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> resource_path<span class="token operator">=</span><span class="token string">&quot;/home/user/Pikachu&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="face-algorithm-session" tabindex="-1"><a class="header-anchor" href="#face-algorithm-session"><span>Face Algorithm Session</span></a></h2><p>InspireFace&#39;s facial analysis algorithms are all concentrated in the session. You can use the session instance to perform <strong>face recognition</strong>, <strong>face embedding extraction</strong>, <strong>face detection</strong>, <strong>face tracking</strong>, <strong>landmark localization</strong>, <strong>liveness detection</strong>, <strong>head pose estimation</strong>, <strong>attribute recognition</strong>, and other functions.</p><p>Since the session contains some cache, <strong>we recommend</strong> using one session within a thread, and <strong>we don&#39;t recommend</strong> cross-using internal data from multiple sessions in tracking mode, as this can easily cause confusion. Sessions can be freely created and destroyed anywhere.</p><img src="https://inspireface-1259028827.cos.ap-singapore.myqcloud.com/docs/pipeline.png"><h3 id="create-session" tabindex="-1"><a class="header-anchor" href="#create-session"><span>Create Session</span></a></h3><p>When creating a session, there are some important parameters that need to be specified:</p><ul><li><strong>Option</strong>: Features that need to be turned on, such as face recognition, mask detection, face attributes. This step will increase the memory used by the session</li><li><strong>Detect Mode</strong>: <ul><li><strong>Always Detection</strong>: Face detection is performed each time, usually for image input or scenes where faces do not need to be tracked</li><li><strong>Light Tracking</strong>: Lightweight face tracking algorithm, support input frame sequence tracking face, tracking speed is extremely fast</li><li><strong>Tracking by Detection</strong>: With detector-dependent tracking, detection is performed every frame, with low speed and high precision</li></ul></li><li><strong>Max Faces</strong>: Limit the maximum number of faces to detect, if the number of faces is too large, the algorithm will be slow</li><li><strong>Detect Pixel Level</strong>: Face detector level, the higher the more accurate, but also affect the execution speed, usually 160, 192, 256, 320, 640</li></ul><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>When creating a session, it will use device memory, and as more options are enabled, the memory usage increases. Appropriately disabling some unnecessary features can save memory.</p></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Enable the functions: face recognition, mask detection, live detection, and face quality detection</span></span>
<span class="line">opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_RECOGNITION <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_QUALITY <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_MASK_DETECT <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_LIVENESS</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create session with options</span></span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span></span>
<span class="line">    param<span class="token operator">=</span>opt<span class="token punctuation">,</span>  <span class="token comment"># Features to enable</span></span>
<span class="line">    detect_mode<span class="token operator">=</span>isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">,</span>  <span class="token comment"># Detection mode</span></span>
<span class="line">    max_detect_num<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>  <span class="token comment"># Maximum number of faces to detect</span></span>
<span class="line">    detect_pixel_level<span class="token operator">=</span><span class="token number">160</span><span class="token punctuation">,</span>  <span class="token comment"># Detection precision level</span></span>
<span class="line">    track_by_detect_mode_fps<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>  <span class="token comment"># FPS for tracking mode (optional)</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Alternative: Using SessionCustomParameter for more control</span></span>
<span class="line">custom_param <span class="token operator">=</span> isf<span class="token punctuation">.</span>SessionCustomParameter<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">custom_param<span class="token punctuation">.</span>enable_recognition <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">custom_param<span class="token punctuation">.</span>enable_liveness <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">custom_param<span class="token punctuation">.</span>enable_mask_detect <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line">custom_param<span class="token punctuation">.</span>enable_face_quality <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line"></span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span></span>
<span class="line">    param<span class="token operator">=</span>custom_param<span class="token punctuation">,</span></span>
<span class="line">    detect_mode<span class="token operator">=</span>isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">,</span></span>
<span class="line">    max_detect_num<span class="token operator">=</span><span class="token number">20</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-detection" tabindex="-1"><a class="header-anchor" href="#face-detection"><span>Face Detection</span></a></h3><p>Face detection is the first step in the analysis of faces, which requires the input of an image or frame:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create session</span></span>
<span class="line">opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_RECOGNITION</span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Set detection confidence threshold</span></span>
<span class="line">session<span class="token punctuation">.</span>set_detection_confidence_threshold<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Load image</span></span>
<span class="line">image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&quot;path/to/image.jpg&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Detect faces</span></span>
<span class="line">faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Detected </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> faces&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Access face information</span></span>
<span class="line"><span class="token keyword">for</span> idx<span class="token punctuation">,</span> face <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face </span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string">:&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Track ID: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>track_id<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Location: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>location<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># (x1, y1, x2, y2)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Detection confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>detection_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Euler angles - Roll: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>roll<span class="token punctuation">}</span></span><span class="token string">, Yaw: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>yaw<span class="token punctuation">}</span></span><span class="token string">, Pitch: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>pitch<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://inspireface-1259028827.cos.ap-singapore.myqcloud.com/docs/feature/lmk.jpg" alt="landmark"></p><h3 id="face-landmark" tabindex="-1"><a class="header-anchor" href="#face-landmark"><span>Face Landmark</span></a></h3><p>Face landmark prediction can be used in any detection mode state, but it should be noted that if the detection mode is in <strong>TRACK</strong> state, you will get smoother facial landmark points. We provide two solutions: 5 basic key points and denser key points (more than 100 points).</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Get 5 key points (eyes, nose, mouth corners)</span></span>
<span class="line">five_points <span class="token operator">=</span> session<span class="token punctuation">.</span>get_face_five_key_points<span class="token punctuation">(</span>face<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Five key points shape: </span><span class="token interpolation"><span class="token punctuation">{</span>five_points<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># (5, 2)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Get dense landmarks (100+ points)</span></span>
<span class="line">dense_landmarks <span class="token operator">=</span> session<span class="token punctuation">.</span>get_face_dense_landmark<span class="token punctuation">(</span>face<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Dense landmarks shape: </span><span class="token interpolation"><span class="token punctuation">{</span>dense_landmarks<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># (N, 2)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Draw landmarks on image</span></span>
<span class="line"><span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> dense_landmarks<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://inspireface-1259028827.cos.ap-singapore.myqcloud.com/docs/out-8.gif" width="200" height="200"><p>For tracking mode, you can set smoothing parameters:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Set tracking mode parameters for smoother landmarks</span></span>
<span class="line">session<span class="token punctuation">.</span>set_track_mode_smooth_ratio<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span></span>
<span class="line">session<span class="token punctuation">.</span>set_track_mode_num_smooth_cache_frame<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-embedding" tabindex="-1"><a class="header-anchor" href="#face-embedding"><span>Face Embedding</span></a></h3><p>Get face embedding is an important step in face recognition, comparison or face swap, which usually needs to be carried out after face detection or tracking.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Extract face features</span></span>
<span class="line">feature <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>image<span class="token punctuation">,</span> face<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Feature vector shape: </span><span class="token interpolation"><span class="token punctuation">{</span>feature<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>  <span class="token comment"># Usually (512,) or similar</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Compare two face features</span></span>
<span class="line">similarity <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_comparison<span class="token punctuation">(</span>feature1<span class="token punctuation">,</span> feature2<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Similarity score: </span><span class="token interpolation"><span class="token punctuation">{</span>similarity<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check if they are the same person</span></span>
<span class="line">threshold <span class="token operator">=</span> isf<span class="token punctuation">.</span>get_recommended_cosine_threshold<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">is_same_person <span class="token operator">=</span> similarity <span class="token operator">&gt;</span> threshold</span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Same person: </span><span class="token interpolation"><span class="token punctuation">{</span>is_same_person<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Convert to percentage</span></span>
<span class="line">percentage <span class="token operator">=</span> isf<span class="token punctuation">.</span>cosine_similarity_convert_to_percentage<span class="token punctuation">(</span>similarity<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Similarity percentage: </span><span class="token interpolation"><span class="token punctuation">{</span>percentage<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-pose-estimation" tabindex="-1"><a class="header-anchor" href="#face-pose-estimation"><span>Face Pose Estimation</span></a></h3><p>When you create a session with the <strong>HF_ENABLE_FACE_POSE</strong> option enabled, you can obtain face pose Euler angle values from face detection results:</p><ul><li><strong>roll</strong>: Head rotation around the Z-axis (tilting left/right)</li><li><strong>yaw</strong>: Head rotation around the Y-axis (turning left/right)</li><li><strong>pitch</strong>: Head rotation around the X-axis (nodding up/down)</li></ul><img src="https://inspireface-1259028827.cos.ap-singapore.myqcloud.com/docs/feature/pose.jpg" alt="pose" style="max-width:250px;"><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Enable pose estimation</span></span>
<span class="line">opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_RECOGNITION <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_POSE</span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">for</span> face <span class="token keyword">in</span> faces<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Pose angles - Roll: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>roll<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">, Yaw: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>yaw<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">, Pitch: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>pitch<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="face-pipeline" tabindex="-1"><a class="header-anchor" href="#face-pipeline"><span>Face Pipeline</span></a></h2><p>If you want to access facial attribute functions such as Anti-Spoofing, mask detection, quality detection, and facial motion recognition, you need to call the Pipeline interface to execute these functions.</p><img src="https://inspireface-1259028827.cos.ap-singapore.myqcloud.com/docs/pip_bn.png" alt="quality" style="max-height:200px;"><h3 id="execute-the-face-pipeline" tabindex="-1"><a class="header-anchor" href="#execute-the-face-pipeline"><span>Execute the Face Pipeline</span></a></h3><p>To execute the Pipeline function, you need to first perform face detection to obtain face information, select the faces you want to execute the pipeline on as input parameters, and configure the corresponding Option for the functions you want to call.</p><p>All functions require only one pipeline interface call, which simplifies frequent calling scenarios.</p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Ensure that the Option is included when creating the Session. The executed Option must be a subset of or identical to the Session&#39;s Option. If the execution exceeds the configured Session Option functionality scope, it will fail to execute!</p></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Create session with multiple features enabled</span></span>
<span class="line">opt <span class="token operator">=</span> <span class="token punctuation">(</span>isf<span class="token punctuation">.</span>HF_ENABLE_FACE_RECOGNITION <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_QUALITY <span class="token operator">|</span> </span>
<span class="line">       isf<span class="token punctuation">.</span>HF_ENABLE_MASK_DETECT <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_LIVENESS <span class="token operator">|</span> </span>
<span class="line">       isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_ATTRIBUTE <span class="token operator">|</span> </span>
<span class="line">       isf<span class="token punctuation">.</span>HF_ENABLE_FACE_EMOTION<span class="token punctuation">)</span></span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Detect faces first</span></span>
<span class="line">faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Execute pipeline with selected functions</span></span>
<span class="line">pipeline_opt <span class="token operator">=</span> <span class="token punctuation">(</span>isf<span class="token punctuation">.</span>HF_ENABLE_QUALITY <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_MASK_DETECT <span class="token operator">|</span> </span>
<span class="line">                isf<span class="token punctuation">.</span>HF_ENABLE_LIVENESS <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_ATTRIBUTE<span class="token punctuation">)</span></span>
<span class="line">face_extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> pipeline_opt<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Access results</span></span>
<span class="line"><span class="token keyword">for</span> idx<span class="token punctuation">,</span> ext <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>face_extensions<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face </span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string"> pipeline results:&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Quality confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>quality_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  RGB liveness confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>rgb_liveness_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Mask confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>mask_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-rgb-anti-spoofing" tabindex="-1"><a class="header-anchor" href="#face-rgb-anti-spoofing"><span>Face RGB Anti-Spoofing</span></a></h3><p>When you configure and execute a Pipeline with the Option containing <strong>HF_ENABLE_LIVENESS</strong>, you can obtain the RGB Anti-Spoofing detection confidence:</p><img src="https://inspireface-1259028827.cos.ap-singapore.myqcloud.com/docs/feature/liveness.jpg" alt="liveness" style="max-width:220px;"><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Enable liveness detection</span></span>
<span class="line">opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_LIVENESS</span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line">extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_LIVENESS<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">:</span></span>
<span class="line">    liveness_score <span class="token operator">=</span> ext<span class="token punctuation">.</span>rgb_liveness_confidence</span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;RGB Liveness confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>liveness_score<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    is_real <span class="token operator">=</span> liveness_score <span class="token operator">&gt;</span> <span class="token number">0.5</span>  <span class="token comment"># Adjust threshold as needed</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Is real person: </span><span class="token interpolation"><span class="token punctuation">{</span>is_real<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-mask-detection" tabindex="-1"><a class="header-anchor" href="#face-mask-detection"><span>Face Mask Detection</span></a></h3><p>When you configure and execute a Pipeline with the Option containing <strong>HF_ENABLE_MASK_DETECT</strong>, you can obtain the face mask detection confidence:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_MASK_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">:</span></span>
<span class="line">    mask_score <span class="token operator">=</span> ext<span class="token punctuation">.</span>mask_confidence</span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Mask confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>mask_score<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    wearing_mask <span class="token operator">=</span> mask_score <span class="token operator">&gt;</span> <span class="token number">0.5</span>  <span class="token comment"># Adjust threshold as needed</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Wearing mask: </span><span class="token interpolation"><span class="token punctuation">{</span>wearing_mask<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-quality-prediction" tabindex="-1"><a class="header-anchor" href="#face-quality-prediction"><span>Face Quality Prediction</span></a></h3><p>When you configure and execute a Pipeline with the Option containing <strong>HF_ENABLE_QUALITY</strong>, you can obtain face quality. This is a comprehensive confidence score based on attributes that affect clarity such as blur, occlusion, and lighting:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_QUALITY<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">:</span></span>
<span class="line">    quality_score <span class="token operator">=</span> ext<span class="token punctuation">.</span>quality_confidence</span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face quality: </span><span class="token interpolation"><span class="token punctuation">{</span>quality_score<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    good_quality <span class="token operator">=</span> quality_score <span class="token operator">&gt;</span> <span class="token number">0.5</span>  <span class="token comment"># Adjust threshold as needed</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Good quality: </span><span class="token interpolation"><span class="token punctuation">{</span>good_quality<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="eyes-state-prediction" tabindex="-1"><a class="header-anchor" href="#eyes-state-prediction"><span>Eyes State Prediction</span></a></h3><p>When you configure and execute a Pipeline with the Option containing <strong>HF_ENABLE_INTERACTION</strong>, you can obtain the static action state of the current frame (currently only supports eye state):</p><ul><li><strong>left_eye_status_confidence</strong>: Left eye state: confidence close to 1 means open, close to 0 means closed</li><li><strong>right_eye_status_confidence</strong>: Right eye state: confidence close to 1 means open, close to 0 means closed</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">:</span></span>
<span class="line">    left_eye_open <span class="token operator">=</span> ext<span class="token punctuation">.</span>left_eye_status_confidence <span class="token operator">&gt;</span> <span class="token number">0.5</span></span>
<span class="line">    right_eye_open <span class="token operator">=</span> ext<span class="token punctuation">.</span>right_eye_status_confidence <span class="token operator">&gt;</span> <span class="token number">0.5</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Left eye open: </span><span class="token interpolation"><span class="token punctuation">{</span>left_eye_open<span class="token punctuation">}</span></span><span class="token string">, Right eye open: </span><span class="token interpolation"><span class="token punctuation">{</span>right_eye_open<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-interactions-action-detection" tabindex="-1"><a class="header-anchor" href="#face-interactions-action-detection"><span>Face Interactions Action Detection</span></a></h3><p>When you configure and execute a Pipeline with the Option containing <strong>HF_ENABLE_INTERACTION</strong> and are in <strong>TRACK</strong> mode, you can obtain a series of facial actions calculated through consecutive sequence frames. These are typically used for interactive scenarios such as combining with liveness detection:</p><ul><li><strong>action_normal</strong>: Normal state, no special actions</li><li><strong>action_shake</strong>: Head shaking action, moving head left and right</li><li><strong>action_jaw_open</strong>: Mouth opening action, opening the mouth</li><li><strong>action_head_raise</strong>: Head raising action, lifting the head upward</li><li><strong>action_blink</strong>: Blinking action, closing and opening the eyes</li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Use tracking mode for action detection</span></span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_LIGHT_TRACK<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">:</span></span>
<span class="line">    actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_normal<span class="token punctuation">:</span></span>
<span class="line">        actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Normal&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_shake<span class="token punctuation">:</span></span>
<span class="line">        actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Head Shake&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_jaw_open<span class="token punctuation">:</span></span>
<span class="line">        actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Jaw Open&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_head_raise<span class="token punctuation">:</span></span>
<span class="line">        actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Head Raise&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_blink<span class="token punctuation">:</span></span>
<span class="line">        actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Blink&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Detected actions: </span><span class="token interpolation"><span class="token punctuation">{</span>actions<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-emotion-prediction" tabindex="-1"><a class="header-anchor" href="#face-emotion-prediction"><span>Face Emotion Prediction</span></a></h3><p>When you configure and execute a Pipeline with the Option containing <strong>HF_ENABLE_FACE_EMOTION</strong>, you can obtain facial expression recognition results:</p><ul><li><strong>emotion</strong>: Detected facial emotion type, returns corresponding integer values: <ul><li>0: Neutral</li><li>1: Happy</li><li>2: Sad</li><li>3: Surprise</li><li>4: Fear</li><li>5: Disgust</li><li>6: Anger</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">emotion_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Neutral&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Happy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Sad&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Surprise&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Fear&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Disgust&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Anger&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_EMOTION<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">:</span></span>
<span class="line">    emotion_label <span class="token operator">=</span> emotion_tags<span class="token punctuation">[</span>ext<span class="token punctuation">.</span>emotion<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Detected emotion: </span><span class="token interpolation"><span class="token punctuation">{</span>emotion_label<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="face-attribute-prediction" tabindex="-1"><a class="header-anchor" href="#face-attribute-prediction"><span>Face Attribute Prediction</span></a></h3><p>When you configure and execute a Pipeline with the Option containing <strong>HF_ENABLE_FACE_ATTRIBUTE</strong>, you can obtain facial attribute recognition results, including race, gender, and age bracket:</p><ul><li><p><strong>race</strong>: Detected facial race type, returns corresponding integer values:</p><ul><li>0: Black</li><li>1: Asian</li><li>2: Latino/Hispanic</li><li>3: Middle Eastern</li><li>4: White</li></ul></li><li><p><strong>gender</strong>: Detected facial gender, returns corresponding integer values:</p><ul><li>0: Female</li><li>1: Male</li></ul></li><li><p><strong>age_bracket</strong>: Detected facial age bracket, returns corresponding integer values:</p><ul><li>0: 0-2 years old</li><li>1: 3-9 years old</li><li>2: 10-19 years old</li><li>3: 20-29 years old</li><li>4: 30-39 years old</li><li>5: 40-49 years old</li><li>6: 50-59 years old</li><li>7: 60-69 years old</li><li>8: More than 70 years old</li></ul></li></ul><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line">race_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Black&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Asian&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Latino/Hispanic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Middle Eastern&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;White&quot;</span><span class="token punctuation">]</span></span>
<span class="line">gender_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Female&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Male&quot;</span><span class="token punctuation">]</span></span>
<span class="line">age_bracket_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;0-2 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3-9 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10-19 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;20-29 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;30-39 years old&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">&quot;40-49 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;50-59 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;60-69 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;more than 70 years old&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">extensions <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_ATTRIBUTE<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">for</span> ext <span class="token keyword">in</span> extensions<span class="token punctuation">:</span></span>
<span class="line">    race <span class="token operator">=</span> race_tags<span class="token punctuation">[</span>ext<span class="token punctuation">.</span>race<span class="token punctuation">]</span></span>
<span class="line">    gender <span class="token operator">=</span> gender_tags<span class="token punctuation">[</span>ext<span class="token punctuation">.</span>gender<span class="token punctuation">]</span></span>
<span class="line">    age <span class="token operator">=</span> age_bracket_tags<span class="token punctuation">[</span>ext<span class="token punctuation">.</span>age_bracket<span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Attributes: </span><span class="token interpolation"><span class="token punctuation">{</span>gender<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>race<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>age<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="face-embedding-database" tabindex="-1"><a class="header-anchor" href="#face-embedding-database"><span>Face Embedding Database</span></a></h2><p>We provide a lightweight face embedding vector database (<strong>FeatureHub</strong>) storage solution that includes basic functions such as adding, deleting, modifying, and searching, while supporting both <strong>memory</strong> and <strong>persistent</strong> storage modes.</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Although we provide a lightweight vector storage and retrieval function, it is not necessary. If it cannot meet your performance requirements, we encourage you to manage the face embeddings yourself.</p></div><p>Before starting FeatureHub, you need to be familiar with the following parameters:</p><ul><li><strong>primary_key_mode</strong>: Primary key mode, with two modes available. It&#39;s recommended to use HF_PK_AUTO_INCREMENT by default <ul><li>HF_PK_AUTO_INCREMENT: Auto-increment mode for primary keys</li><li>HF_PK_MANUAL_INPUT: Manual input mode for primary keys, requiring users to avoid duplicate primary keys themselves</li></ul></li><li><strong>enable_persistence</strong>: Whether to enable persistent database storage mode <ul><li>If True: The database will write to local files for persistent storage during usage</li><li>If False: High-speed memory management mode, dependent on program lifecycle</li></ul></li><li><strong>persistence_db_path</strong>: Storage path required only for persistent mode, defined by the user. If the input is a folder rather than a file, the system default file naming will be used</li><li><strong>search_threshold</strong>: Face search threshold, using floating-point numbers. During search, only embeddings above the threshold are searched. Different models and scenarios require manual threshold settings</li><li><strong>search_mode</strong>: Search mode, <strong>effective only when searching for top-1 face</strong>, with EAGER and EXHAUSTIVE modes <ul><li>HF_SEARCH_MODE_EAGER: Complete search immediately upon encountering the first face above the threshold</li><li>HF_SEARCH_MODE_EXHAUSTIVE: Search all similar faces and return the one with the highest similarity</li></ul></li></ul><h3 id="enable-disable-featurehub" tabindex="-1"><a class="header-anchor" href="#enable-disable-featurehub"><span>Enable/Disable FeatureHub</span></a></h3><p>Using thread-safe singleton pattern design, it has global scope and only needs to be opened once:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Configure FeatureHub</span></span>
<span class="line">config <span class="token operator">=</span> isf<span class="token punctuation">.</span>FeatureHubConfiguration<span class="token punctuation">(</span></span>
<span class="line">    primary_key_mode<span class="token operator">=</span>isf<span class="token punctuation">.</span>HF_PK_AUTO_INCREMENT<span class="token punctuation">,</span>  <span class="token comment"># Recommended auto increment</span></span>
<span class="line">    enable_persistence<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  <span class="token comment"># Enable persistent storage</span></span>
<span class="line">    persistence_db_path<span class="token operator">=</span><span class="token string">&quot;face_database.db&quot;</span><span class="token punctuation">,</span>  <span class="token comment"># Database file path</span></span>
<span class="line">    search_threshold<span class="token operator">=</span><span class="token number">0.48</span><span class="token punctuation">,</span>  <span class="token comment"># Search threshold</span></span>
<span class="line">    search_mode<span class="token operator">=</span>isf<span class="token punctuation">.</span>HF_SEARCH_MODE_EXHAUSTIVE  <span class="token comment"># Search mode</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Enable FeatureHub</span></span>
<span class="line">ret <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_enable<span class="token punctuation">(</span>config<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">assert</span> ret<span class="token punctuation">,</span> <span class="token string">&quot;Failed to enable FeatureHub&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># ... use FeatureHub for operations ...</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Disable when not needed (optional)</span></span>
<span class="line">isf<span class="token punctuation">.</span>feature_hub_disable<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="insert-face-embedding" tabindex="-1"><a class="header-anchor" href="#insert-face-embedding"><span>Insert Face Embedding</span></a></h3><p>Insert a face embedding feature vector into FeatureHub. If in HF_PK_AUTO_INCREMENT mode, the input identity.id will be ignored. If in HF_PK_MANUAL_INPUT mode, the input identity.id is the ID the user expects to insert.</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Extract face feature</span></span>
<span class="line">faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line">feature <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Create face identity</span></span>
<span class="line">face_identity <span class="token operator">=</span> isf<span class="token punctuation">.</span>FaceIdentity<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># id will be auto-assigned</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Insert into FeatureHub</span></span>
<span class="line">success<span class="token punctuation">,</span> allocated_id <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_insert<span class="token punctuation">(</span>face_identity<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> success<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face inserted with ID: </span><span class="token interpolation"><span class="token punctuation">{</span>allocated_id<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to insert face&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="search-most-similar-face" tabindex="-1"><a class="header-anchor" href="#search-most-similar-face"><span>Search Most Similar Face</span></a></h3><p>Input a face embedding to be queried and search for a face ID from FeatureHub that is above the threshold (Cosine similarity).</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Extract query feature</span></span>
<span class="line">query_faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>query_image<span class="token punctuation">)</span></span>
<span class="line">query_feature <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>query_image<span class="token punctuation">,</span> query_faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Search for similar face</span></span>
<span class="line">search_result <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_search<span class="token punctuation">(</span>query_feature<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> search_result<span class="token punctuation">.</span>similar_identity<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Found similar face with ID: </span><span class="token interpolation"><span class="token punctuation">{</span>search_result<span class="token punctuation">.</span>similar_identity<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>search_result<span class="token punctuation">.</span>confidence<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;No similar face found&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="search-top-k-faces" tabindex="-1"><a class="header-anchor" href="#search-top-k-faces"><span>Search Top-K Faces</span></a></h3><p>Search for the top K faces with the highest similarity:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Search top 10 most similar faces</span></span>
<span class="line">top_k_results <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_search_top_k<span class="token punctuation">(</span>query_feature<span class="token punctuation">,</span> top_k<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Found </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>top_k_results<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> similar faces:&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">for</span> idx<span class="token punctuation">,</span> <span class="token punctuation">(</span>confidence<span class="token punctuation">,</span> face_id<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>top_k_results<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Rank </span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">: ID=</span><span class="token interpolation"><span class="token punctuation">{</span>face_id<span class="token punctuation">}</span></span><span class="token string">, Confidence=</span><span class="token interpolation"><span class="token punctuation">{</span>confidence<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="delete-face-embedding" tabindex="-1"><a class="header-anchor" href="#delete-face-embedding"><span>Delete Face Embedding</span></a></h3><p>Specify a face ID to delete that face from FeatureHub:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Remove face by ID</span></span>
<span class="line">success <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_remove<span class="token punctuation">(</span>face_id<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> success<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face with ID </span><span class="token interpolation"><span class="token punctuation">{</span>face_id<span class="token punctuation">}</span></span><span class="token string"> removed successfully&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Failed to remove face with ID </span><span class="token interpolation"><span class="token punctuation">{</span>face_id<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="update-face-embedding" tabindex="-1"><a class="header-anchor" href="#update-face-embedding"><span>Update Face Embedding</span></a></h3><p>You can replace the existing feature vectors in the database through the update interface:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Update existing face with new feature</span></span>
<span class="line">new_feature <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>new_image<span class="token punctuation">,</span> new_face<span class="token punctuation">)</span></span>
<span class="line">updated_identity <span class="token operator">=</span> isf<span class="token punctuation">.</span>FaceIdentity<span class="token punctuation">(</span>new_feature<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span>existing_id<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">success <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_update<span class="token punctuation">(</span>updated_identity<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> success<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face with ID </span><span class="token interpolation"><span class="token punctuation">{</span>existing_id<span class="token punctuation">}</span></span><span class="token string"> updated successfully&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Failed to update face with ID </span><span class="token interpolation"><span class="token punctuation">{</span>existing_id<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="get-face-embedding-from-id" tabindex="-1"><a class="header-anchor" href="#get-face-embedding-from-id"><span>Get Face Embedding from ID</span></a></h3><p>You can quickly obtain FaceIdentity related information through a face ID:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Retrieve face identity by ID</span></span>
<span class="line">face_identity <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_get_face_identity<span class="token punctuation">(</span>face_id<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> face_identity<span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Retrieved face with ID: </span><span class="token interpolation"><span class="token punctuation">{</span>face_identity<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Feature shape: </span><span class="token interpolation"><span class="token punctuation">{</span>face_identity<span class="token punctuation">.</span>feature<span class="token punctuation">.</span>shape<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face with ID </span><span class="token interpolation"><span class="token punctuation">{</span>face_id<span class="token punctuation">}</span></span><span class="token string"> not found&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dynamic-search-threshold-adjustment" tabindex="-1"><a class="header-anchor" href="#dynamic-search-threshold-adjustment"><span>Dynamic Search Threshold Adjustment</span></a></h3><p>You can dynamically modify FeatureHub&#39;s search threshold in different scenarios:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Set new search threshold</span></span>
<span class="line">isf<span class="token punctuation">.</span>feature_hub_set_search_threshold<span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="database-management" tabindex="-1"><a class="header-anchor" href="#database-management"><span>Database Management</span></a></h3><p>Additional utility functions for database management:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Get total face count</span></span>
<span class="line">total_faces <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_get_face_count<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Total faces in database: </span><span class="token interpolation"><span class="token punctuation">{</span>total_faces<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Get list of all face IDs</span></span>
<span class="line">face_ids <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_get_face_id_list<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Face IDs: </span><span class="token interpolation"><span class="token punctuation">{</span>face_ids<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># View database table in terminal (for debugging)</span></span>
<span class="line">isf<span class="token punctuation">.</span>view_table_in_terminal<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="example-face-detect-and-pipeline" tabindex="-1"><a class="header-anchor" href="#example-face-detect-and-pipeline"><span>[Example]Face Detect and Pipeline</span></a></h2><p>Face detection and some use cases of face attribute analysis:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"><span class="token keyword">import</span> click</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line">race_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Black&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Asian&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Latino/Hispanic&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Middle Eastern&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;White&quot;</span><span class="token punctuation">]</span></span>
<span class="line">gender_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;Female&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Male&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">]</span></span>
<span class="line">age_bracket_tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;0-2 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3-9 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;10-19 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;20-29 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;30-39 years old&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token string">&quot;40-49 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;50-59 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;60-69 years old&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;more than 70 years old&quot;</span><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>argument</span><span class="token punctuation">(</span><span class="token string">&#39;image_path&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">case_face_detection_image</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">    This is a sample application for face detection and tracking using an image.</span>
<span class="line">    It also includes pipeline extensions such as RGB liveness, mask detection, and face quality evaluation.</span>
<span class="line">    &quot;&quot;&quot;</span></span>
<span class="line">    <span class="token comment"># Optional features, loaded during session creation based on the modules specified.</span></span>
<span class="line">    opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_RECOGNITION <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_QUALITY <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_MASK_DETECT <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_LIVENESS <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_ATTRIBUTE</span>
<span class="line">    session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Set detection confidence threshold</span></span>
<span class="line">    session<span class="token punctuation">.</span>set_detection_confidence_threshold<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Load the image using OpenCV.</span></span>
<span class="line">    image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> image <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">&quot;Please check that the image path is correct.&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Perform face detection on the image.</span></span>
<span class="line">    faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;face detection: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> found&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Copy the image for drawing the bounding boxes.</span></span>
<span class="line">    draw <span class="token operator">=</span> image<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> face <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">&#39;==&#39;</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;idx: </span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;detection confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>detection_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># Print Euler angles of the face.</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;roll: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>roll<span class="token punctuation">}</span></span><span class="token string">, yaw: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>yaw<span class="token punctuation">}</span></span><span class="token string">, pitch: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>pitch<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Get face bounding box</span></span>
<span class="line">        x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> face<span class="token punctuation">.</span>location</span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Calculate center, size, and angle</span></span>
<span class="line">        center <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">+</span> x2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y1 <span class="token operator">+</span> y2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">        size <span class="token operator">=</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">,</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span></span>
<span class="line">        angle <span class="token operator">=</span> face<span class="token punctuation">.</span>roll</span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Apply rotation to the bounding box corners</span></span>
<span class="line">        rect <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> angle<span class="token punctuation">)</span></span>
<span class="line">        box <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boxPoints<span class="token punctuation">(</span>rect<span class="token punctuation">)</span></span>
<span class="line">        box <span class="token operator">=</span> box<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Draw the rotated bounding box</span></span>
<span class="line">        cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>draw<span class="token punctuation">,</span> <span class="token punctuation">[</span>box<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Draw landmarks</span></span>
<span class="line">        lmk <span class="token operator">=</span> session<span class="token punctuation">.</span>get_face_dense_landmark<span class="token punctuation">(</span>face<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> lmk<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>draw<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Features must be enabled during session creation to use them here.</span></span>
<span class="line">    select_exec_func <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_QUALITY <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_MASK_DETECT <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_LIVENESS <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_ATTRIBUTE</span>
<span class="line">    <span class="token comment"># Execute the pipeline to obtain richer face information.</span></span>
<span class="line">    extends <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>image<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> select_exec_func<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> ext <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>extends<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">&#39;==&#39;</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;idx: </span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token comment"># For these pipeline results, you can set thresholds based on the specific scenario to make judgments.</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;quality: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>quality_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;rgb liveness: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>rgb_liveness_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;face mask: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>mask_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token string-interpolation"><span class="token string">f&quot;face eyes status: left eye: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>left_eye_status_confidence<span class="token punctuation">}</span></span><span class="token string"> right eye: </span><span class="token interpolation"><span class="token punctuation">{</span>ext<span class="token punctuation">.</span>right_eye_status_confidence<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;gender: </span><span class="token interpolation"><span class="token punctuation">{</span>gender_tags<span class="token punctuation">[</span>ext<span class="token punctuation">.</span>gender<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;race: </span><span class="token interpolation"><span class="token punctuation">{</span>race_tags<span class="token punctuation">[</span>ext<span class="token punctuation">.</span>race<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;age: </span><span class="token interpolation"><span class="token punctuation">{</span>age_bracket_tags<span class="token punctuation">[</span>ext<span class="token punctuation">.</span>age_bracket<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Save the annotated image to the &#39;tmp/&#39; directory.</span></span>
<span class="line">    save_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">&quot;tmp/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;det.jpg&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> draw<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;\\nSave annotated image to </span><span class="token interpolation"><span class="token punctuation">{</span>save_path<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span><span class="token string">&quot;tmp&quot;</span><span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></span>
<span class="line">    case_face_detection_image<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="example-face-comparison" tabindex="-1"><a class="header-anchor" href="#example-face-comparison"><span>[Example]Face Comparison</span></a></h2><p>Face comparison 1:1 use case:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"><span class="token keyword">import</span> click</span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>argument</span><span class="token punctuation">(</span><span class="token string">&#39;image_path1&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>argument</span><span class="token punctuation">(</span><span class="token string">&#39;image_path2&#39;</span><span class="token punctuation">)</span> </span>
<span class="line"><span class="token keyword">def</span> <span class="token function">case_face_comparison</span><span class="token punctuation">(</span>image_path1<span class="token punctuation">,</span> image_path2<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">    This is a sample application for comparing two face images.</span>
<span class="line">    Args:</span>
<span class="line">        image_path1 (str): Path to the first face image</span>
<span class="line">        image_path2 (str): Path to the second face image</span>
<span class="line">    &quot;&quot;&quot;</span></span>
<span class="line">    <span class="token comment"># Enable face recognition features</span></span>
<span class="line">    opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_RECOGNITION</span>
<span class="line">    session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Load and check the first image</span></span>
<span class="line">    image1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>image_path1<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> image1 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to load first image&quot;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Load and check the second image  </span></span>
<span class="line">    image2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>image_path2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> image2 <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string">&quot;Failed to load second image&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Detect faces in first image</span></span>
<span class="line">    faces1 <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image1<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> faces1<span class="token punctuation">,</span> <span class="token string">&quot;No face detected in first image&quot;</span></span>
<span class="line">    face1 <span class="token operator">=</span> faces1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># Use the first detected face</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Detect faces in second image</span></span>
<span class="line">    faces2 <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image2<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> faces2<span class="token punctuation">,</span> <span class="token string">&quot;No face detected in second image&quot;</span></span>
<span class="line">    face2 <span class="token operator">=</span> faces2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># Use the first detected face</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Extract features</span></span>
<span class="line">    feature1 <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>image1<span class="token punctuation">,</span> face1<span class="token punctuation">)</span></span>
<span class="line">    feature2 <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>image2<span class="token punctuation">,</span> face2<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Calculate similarity score between the two faces</span></span>
<span class="line">    similarity <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_comparison<span class="token punctuation">(</span>feature1<span class="token punctuation">,</span> feature2<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;The cosine similarity score: </span><span class="token interpolation"><span class="token punctuation">{</span>similarity<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">&#39;Same person&#39;</span> <span class="token keyword">if</span> similarity <span class="token operator">&gt;</span> isf<span class="token punctuation">.</span>get_recommended_cosine_threshold<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">&#39;Different person&#39;</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    percentage <span class="token operator">=</span> isf<span class="token punctuation">.</span>cosine_similarity_convert_to_percentage<span class="token punctuation">(</span>similarity<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;The percentage similarity: </span><span class="token interpolation"><span class="token punctuation">{</span>percentage<span class="token punctuation">:</span><span class="token format-spec">.4f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    case_face_comparison<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="example-face-recognition-with-featurehub" tabindex="-1"><a class="header-anchor" href="#example-face-recognition-with-featurehub"><span>[Example]Face Recognition with FeatureHub</span></a></h2><p>Face recognition system using FeatureHub for face database management:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> os</span>
<span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"><span class="token keyword">import</span> click</span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>argument</span><span class="token punctuation">(</span><span class="token string">&#39;test_data_folder&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">case_face_recognition</span><span class="token punctuation">(</span>test_data_folder<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">    Launches the face recognition system, inserts face features into a database, and performs searches.</span>
<span class="line">    &quot;&quot;&quot;</span></span>
<span class="line">    <span class="token comment"># Enable face recognition features</span></span>
<span class="line">    opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_FACE_RECOGNITION</span>
<span class="line">    session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_ALWAYS_DETECT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Configure the feature management system</span></span>
<span class="line">    feature_hub_config <span class="token operator">=</span> isf<span class="token punctuation">.</span>FeatureHubConfiguration<span class="token punctuation">(</span></span>
<span class="line">        primary_key_mode<span class="token operator">=</span>isf<span class="token punctuation">.</span>HF_PK_AUTO_INCREMENT<span class="token punctuation">,</span></span>
<span class="line">        enable_persistence<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>  <span class="token comment"># Use memory mode for this example</span></span>
<span class="line">        persistence_db_path<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        search_threshold<span class="token operator">=</span><span class="token number">0.48</span><span class="token punctuation">,</span></span>
<span class="line">        search_mode<span class="token operator">=</span>isf<span class="token punctuation">.</span>HF_SEARCH_MODE_EAGER<span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">)</span></span>
<span class="line">    ret <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_enable<span class="token punctuation">(</span>feature_hub_config<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> ret<span class="token punctuation">,</span> <span class="token string">&quot;Failed to enable FeatureHub.&quot;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Insert face features from &#39;bulk&#39; directory</span></span>
<span class="line">    bulk_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>test_data_folder<span class="token punctuation">,</span> <span class="token string">&quot;bulk&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>bulk_path<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Bulk directory does not exist.&quot;</span></span>
<span class="line"></span>
<span class="line">    insert_images <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>bulk_path<span class="token punctuation">,</span> path<span class="token punctuation">)</span> <span class="token keyword">for</span> path <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>bulk_path<span class="token punctuation">)</span> <span class="token keyword">if</span> path<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">&quot;.jpg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> image_path <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>insert_images<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">assert</span> image <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f&quot;Failed to load image </span><span class="token interpolation"><span class="token punctuation">{</span>image_path<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">        faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> faces<span class="token punctuation">:</span></span>
<span class="line">            face <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># Assume the most prominent face is what we want</span></span>
<span class="line">            feature <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>image<span class="token punctuation">,</span> face<span class="token punctuation">)</span></span>
<span class="line">            identity <span class="token operator">=</span> isf<span class="token punctuation">.</span>FaceIdentity<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span>idx<span class="token punctuation">)</span></span>
<span class="line">            ret<span class="token punctuation">,</span> alloc_id <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_insert<span class="token punctuation">(</span>identity<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">assert</span> ret<span class="token punctuation">,</span> <span class="token string">&quot;Failed to insert face.&quot;</span></span>
<span class="line"></span>
<span class="line">    count <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_get_face_count<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Number of faces inserted: </span><span class="token interpolation"><span class="token punctuation">{</span>count<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Search for a similar face using a query image</span></span>
<span class="line">    query_image_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>test_data_folder<span class="token punctuation">,</span> <span class="token string">&quot;query.jpg&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    query_image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>query_image_path<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> query_image <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f&quot;Failed to load query image&quot;</span></span></span>
<span class="line">    </span>
<span class="line">    faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>query_image<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">assert</span> faces<span class="token punctuation">,</span> <span class="token string">&quot;No faces detected in query image.&quot;</span></span>
<span class="line">    face <span class="token operator">=</span> faces<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    feature <span class="token operator">=</span> session<span class="token punctuation">.</span>face_feature_extract<span class="token punctuation">(</span>query_image<span class="token punctuation">,</span> face<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Single search</span></span>
<span class="line">    search_result <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_search<span class="token punctuation">(</span>feature<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> search_result<span class="token punctuation">.</span>similar_identity<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Found similar identity with ID: </span><span class="token interpolation"><span class="token punctuation">{</span>search_result<span class="token punctuation">.</span>similar_identity<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>search_result<span class="token punctuation">.</span>confidence<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;No similar identity found.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Top-k search</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Top-k similar identities:&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    search_top_k <span class="token operator">=</span> isf<span class="token punctuation">.</span>feature_hub_face_search_top_k<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">for</span> idx<span class="token punctuation">,</span> <span class="token punctuation">(</span>conf<span class="token punctuation">,</span> _id<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>search_top_k<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;  Top-</span><span class="token interpolation"><span class="token punctuation">{</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">: ID: </span><span class="token interpolation"><span class="token punctuation">{</span>_id<span class="token punctuation">}</span></span><span class="token string">, Confidence: </span><span class="token interpolation"><span class="token punctuation">{</span>conf<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    case_face_recognition<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="example-video-face-tracking" tabindex="-1"><a class="header-anchor" href="#example-video-face-tracking"><span>[Example]Video Face Tracking</span></a></h2><p>Real-time face tracking from video source with action detection:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token keyword">import</span> time</span>
<span class="line"><span class="token keyword">import</span> click</span>
<span class="line"><span class="token keyword">import</span> cv2</span>
<span class="line"><span class="token keyword">import</span> inspireface <span class="token keyword">as</span> isf</span>
<span class="line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">generate_color</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;Generate a bright color based on the given integer ID.&quot;&quot;&quot;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token builtin">id</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>  <span class="token comment"># Gray for invalid ID</span></span>
<span class="line">        </span>
<span class="line">    max_id <span class="token operator">=</span> <span class="token number">50</span></span>
<span class="line">    <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">id</span> <span class="token operator">%</span> max_id</span>
<span class="line">    hue <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">id</span> <span class="token operator">*</span> <span class="token number">360</span> <span class="token operator">/</span> max_id<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span></span>
<span class="line">    saturation <span class="token operator">=</span> <span class="token number">200</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">55</span> <span class="token operator">*</span> <span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">55</span></span>
<span class="line">    value <span class="token operator">=</span> <span class="token number">200</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">55</span> <span class="token operator">*</span> <span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">55</span></span>
<span class="line"></span>
<span class="line">    hsv_color <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span>hue<span class="token punctuation">,</span> saturation<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">    rgb_color <span class="token operator">=</span> cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>hsv_color<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>COLOR_HSV2BGR<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>rgb_color<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rgb_color<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rgb_color<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>command</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>argument</span><span class="token punctuation">(</span><span class="token string">&#39;source&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>option</span><span class="token punctuation">(</span><span class="token string">&#39;--show&#39;</span><span class="token punctuation">,</span> is_flag<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;Display the video stream.&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token decorator annotation punctuation">@click<span class="token punctuation">.</span>option</span><span class="token punctuation">(</span><span class="token string">&#39;--out&#39;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">&#39;Path to save processed video.&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> <span class="token function">case_face_tracker_from_video</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> show<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">    Launch face tracking from video source.</span>
<span class="line">    Args:</span>
<span class="line">        source: Webcam index (0, 1, ...) or path to video file</span>
<span class="line">        show: Display video window if set</span>
<span class="line">        out: Output video file path if provided</span>
<span class="line">    &quot;&quot;&quot;</span></span>
<span class="line">    <span class="token comment"># Enable interaction features for action detection</span></span>
<span class="line">    opt <span class="token operator">=</span> isf<span class="token punctuation">.</span>HF_ENABLE_NONE <span class="token operator">|</span> isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION</span>
<span class="line">    session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span>opt<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_DETECT_MODE_LIGHT_TRACK<span class="token punctuation">,</span> max_detect_num<span class="token operator">=</span><span class="token number">25</span><span class="token punctuation">,</span> detect_pixel_level<span class="token operator">=</span><span class="token number">320</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># Configure tracking parameters</span></span>
<span class="line">    session<span class="token punctuation">.</span>set_track_mode_smooth_ratio<span class="token punctuation">(</span><span class="token number">0.06</span><span class="token punctuation">)</span></span>
<span class="line">    session<span class="token punctuation">.</span>set_track_mode_num_smooth_cache_frame<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span></span>
<span class="line">    session<span class="token punctuation">.</span>set_filter_minimum_face_pixel_size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line">    session<span class="token punctuation">.</span>set_track_model_detect_interval<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Open video source</span></span>
<span class="line">    <span class="token keyword">try</span><span class="token punctuation">:</span></span>
<span class="line">        source_index <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Using webcam at index </span><span class="token interpolation"><span class="token punctuation">{</span>source_index<span class="token punctuation">}</span></span><span class="token string">.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>source_index<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Opening video file at </span><span class="token interpolation"><span class="token punctuation">{</span>source<span class="token punctuation">}</span></span><span class="token string">.&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">        cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>source<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token keyword">not</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Error: Could not open video source.&quot;</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">return</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Setup video writer if output path provided</span></span>
<span class="line">    out_video <span class="token operator">=</span> <span class="token boolean">None</span></span>
<span class="line">    <span class="token keyword">if</span> out<span class="token punctuation">:</span></span>
<span class="line">        fourcc <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">&#39;XVID&#39;</span><span class="token punctuation">)</span></span>
<span class="line">        fps <span class="token operator">=</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span> <span class="token keyword">if</span> cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">30</span></span>
<span class="line">        frame_width <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        frame_height <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cap<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        out_video <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span>out<span class="token punctuation">,</span> fourcc<span class="token punctuation">,</span> fps<span class="token punctuation">,</span> <span class="token punctuation">(</span>frame_width<span class="token punctuation">,</span> frame_height<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;Saving video to: </span><span class="token interpolation"><span class="token punctuation">{</span>out<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Main processing loop</span></span>
<span class="line">    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></span>
<span class="line">        ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span></span>
<span class="line">            <span class="token keyword">break</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Detect and track faces</span></span>
<span class="line">        faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>frame<span class="token punctuation">)</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># Execute pipeline for action detection</span></span>
<span class="line">        exts <span class="token operator">=</span> session<span class="token punctuation">.</span>face_pipeline<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> faces<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_ENABLE_INTERACTION<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Draw results</span></span>
<span class="line">        <span class="token keyword">for</span> idx<span class="token punctuation">,</span> face <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>faces<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">            x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2 <span class="token operator">=</span> face<span class="token punctuation">.</span>location</span>
<span class="line">            center <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x1 <span class="token operator">+</span> x2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y1 <span class="token operator">+</span> y2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line">            size <span class="token operator">=</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">,</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span></span>
<span class="line">            angle <span class="token operator">=</span> face<span class="token punctuation">.</span>roll</span>
<span class="line"></span>
<span class="line">            <span class="token comment"># Create rotated bounding box</span></span>
<span class="line">            rect <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>center<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> center<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> angle<span class="token punctuation">)</span></span>
<span class="line">            box <span class="token operator">=</span> cv2<span class="token punctuation">.</span>boxPoints<span class="token punctuation">(</span>rect<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># Get unique color for this track ID</span></span>
<span class="line">            color <span class="token operator">=</span> generate_color<span class="token punctuation">(</span>face<span class="token punctuation">.</span>track_id<span class="token punctuation">)</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># Draw bounding box</span></span>
<span class="line">            cv2<span class="token punctuation">.</span>drawContours<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">[</span>box<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line">            </span>
<span class="line">            <span class="token comment"># Draw landmarks</span></span>
<span class="line">            lmk <span class="token operator">=</span> session<span class="token punctuation">.</span>get_face_dense_landmark<span class="token punctuation">(</span>face<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> lmk<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">                cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># Detect and display actions</span></span>
<span class="line">            <span class="token keyword">if</span> idx <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>exts<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">                ext <span class="token operator">=</span> exts<span class="token punctuation">[</span>idx<span class="token punctuation">]</span></span>
<span class="line">                actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line">                <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_normal<span class="token punctuation">:</span></span>
<span class="line">                    actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Normal&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_jaw_open<span class="token punctuation">:</span></span>
<span class="line">                    actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Jaw Open&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_shake<span class="token punctuation">:</span></span>
<span class="line">                    actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Shake&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_blink<span class="token punctuation">:</span></span>
<span class="line">                    actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Blink&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                <span class="token keyword">if</span> ext<span class="token punctuation">.</span>action_head_raise<span class="token punctuation">:</span></span>
<span class="line">                    actions<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;Head Raise&quot;</span><span class="token punctuation">)</span></span>
<span class="line">                </span>
<span class="line">                <span class="token comment"># Display actions text</span></span>
<span class="line">                <span class="token keyword">if</span> actions<span class="token punctuation">:</span></span>
<span class="line">                    action_text <span class="token operator">=</span> <span class="token string">&quot;, &quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>actions<span class="token punctuation">)</span></span>
<span class="line">                    cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> action_text<span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1 <span class="token operator">-</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </span>
<span class="line">                              cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">            <span class="token comment"># Display track ID</span></span>
<span class="line">            text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;ID: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>track_id<span class="token punctuation">}</span></span><span class="token string">, Count: </span><span class="token interpolation"><span class="token punctuation">{</span>face<span class="token punctuation">.</span>track_count<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1 <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> </span>
<span class="line">                       cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> color<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Show frame</span></span>
<span class="line">        <span class="token keyword">if</span> show<span class="token punctuation">:</span></span>
<span class="line">            cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&quot;Face Tracker&quot;</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span></span>
<span class="line">            <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">&#39;q&#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">                <span class="token keyword">break</span></span>
<span class="line"></span>
<span class="line">        <span class="token comment"># Write frame to output video</span></span>
<span class="line">        <span class="token keyword">if</span> out_video<span class="token punctuation">:</span></span>
<span class="line">            out_video<span class="token punctuation">.</span>write<span class="token punctuation">(</span>frame<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># Cleanup</span></span>
<span class="line">    cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">if</span> out_video<span class="token punctuation">:</span></span>
<span class="line">        out_video<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Released all resources and closed windows.&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&#39;__main__&#39;</span><span class="token punctuation">:</span></span>
<span class="line">    case_face_tracker_from_video<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="advanced-configuration" tabindex="-1"><a class="header-anchor" href="#advanced-configuration"><span>Advanced Configuration</span></a></h2><h3 id="session-parameters" tabindex="-1"><a class="header-anchor" href="#session-parameters"><span>Session Parameters</span></a></h3><p>You can fine-tune session behavior using various parameters:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Create session with custom parameters</span></span>
<span class="line">session <span class="token operator">=</span> isf<span class="token punctuation">.</span>InspireFaceSession<span class="token punctuation">(</span></span>
<span class="line">    param<span class="token operator">=</span>opt<span class="token punctuation">,</span></span>
<span class="line">    detect_mode<span class="token operator">=</span>isf<span class="token punctuation">.</span>HF_DETECT_MODE_LIGHT_TRACK<span class="token punctuation">,</span></span>
<span class="line">    max_detect_num<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span></span>
<span class="line">    detect_pixel_level<span class="token operator">=</span><span class="token number">320</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Configure detection thresholds</span></span>
<span class="line">session<span class="token punctuation">.</span>set_detection_confidence_threshold<span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">)</span></span>
<span class="line">session<span class="token punctuation">.</span>set_filter_minimum_face_pixel_size<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Configure tracking smoothing (for tracking modes)</span></span>
<span class="line">session<span class="token punctuation">.</span>set_track_mode_smooth_ratio<span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">)</span></span>
<span class="line">session<span class="token punctuation">.</span>set_track_mode_num_smooth_cache_frame<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line">session<span class="token punctuation">.</span>set_track_model_detect_interval<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Configure landmark processing</span></span>
<span class="line">session<span class="token punctuation">.</span>set_landmark_augmentation_num<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="utility-functions" tabindex="-1"><a class="header-anchor" href="#utility-functions"><span>Utility Functions</span></a></h3><p>Additional utility functions for system management:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Version information</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;InspireFace version: </span><span class="token interpolation"><span class="token punctuation">{</span>isf<span class="token punctuation">.</span>version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Logging control</span></span>
<span class="line">isf<span class="token punctuation">.</span>set_logging_level<span class="token punctuation">(</span>isf<span class="token punctuation">.</span>HF_LOG_INFO<span class="token punctuation">)</span></span>
<span class="line">isf<span class="token punctuation">.</span>disable_logging<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Disable all logging</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Resource monitoring</span></span>
<span class="line">isf<span class="token punctuation">.</span>show_system_resource_statistics<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Hardware configuration (if applicable)</span></span>
<span class="line"><span class="token keyword">if</span> isf<span class="token punctuation">.</span>check_cuda_device_support<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;CUDA devices available: </span><span class="token interpolation"><span class="token punctuation">{</span>isf<span class="token punctuation">.</span>get_num_cuda_devices<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    isf<span class="token punctuation">.</span>set_cuda_device_id<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># Use first CUDA device</span></span>
<span class="line">    isf<span class="token punctuation">.</span>print_cuda_device_info<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="image-format-support" tabindex="-1"><a class="header-anchor" href="#image-format-support"><span>Image Format Support</span></a></h3><p>InspireFace supports various image formats and rotations:</p><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py"><pre><code><span class="line"><span class="token comment"># Different image formats</span></span>
<span class="line">stream_bgr <span class="token operator">=</span> isf<span class="token punctuation">.</span>ImageStream<span class="token punctuation">.</span>load_from_cv_image<span class="token punctuation">(</span>image<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_STREAM_BGR<span class="token punctuation">)</span></span>
<span class="line">stream_rgb <span class="token operator">=</span> isf<span class="token punctuation">.</span>ImageStream<span class="token punctuation">.</span>load_from_cv_image<span class="token punctuation">(</span>image<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_STREAM_RGB<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Image rotation</span></span>
<span class="line">stream_rotated <span class="token operator">=</span> isf<span class="token punctuation">.</span>ImageStream<span class="token punctuation">.</span>load_from_cv_image<span class="token punctuation">(</span>image<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_STREAM_BGR<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_CAMERA_ROTATION_90<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># From raw buffer</span></span>
<span class="line">buffer_data <span class="token operator">=</span> image<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">stream_buffer <span class="token operator">=</span> isf<span class="token punctuation">.</span>ImageStream<span class="token punctuation">.</span>load_from_buffer<span class="token punctuation">(</span></span>
<span class="line">    buffer_data<span class="token punctuation">,</span> image<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> </span>
<span class="line">    isf<span class="token punctuation">.</span>HF_STREAM_BGR<span class="token punctuation">,</span> isf<span class="token punctuation">.</span>HF_CAMERA_ROTATION_0</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Use custom image stream with session</span></span>
<span class="line">faces <span class="token operator">=</span> session<span class="token punctuation">.</span>face_detection<span class="token punctuation">(</span>stream_bgr<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This comprehensive documentation covers all major functionality of InspireFace Python API, from basic face detection to advanced features like face database management and real-time video tracking. Refer to the example code for practical implementation patterns.</p>`,130)]))}const l=s(p,[["render",i]]),u=JSON.parse('{"path":"/using-with/python.html","title":"Using InspireFace in Python","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"Installation and Setup","slug":"installation-and-setup","link":"#installation-and-setup","children":[]},{"level":2,"title":"Initialization","slug":"initialization","link":"#initialization","children":[]},{"level":2,"title":"How to switch models","slug":"how-to-switch-models","link":"#how-to-switch-models","children":[]},{"level":2,"title":"Face Algorithm Session","slug":"face-algorithm-session","link":"#face-algorithm-session","children":[{"level":3,"title":"Create Session","slug":"create-session","link":"#create-session","children":[]},{"level":3,"title":"Face Detection","slug":"face-detection","link":"#face-detection","children":[]},{"level":3,"title":"Face Landmark","slug":"face-landmark","link":"#face-landmark","children":[]},{"level":3,"title":"Face Embedding","slug":"face-embedding","link":"#face-embedding","children":[]},{"level":3,"title":"Face Pose Estimation","slug":"face-pose-estimation","link":"#face-pose-estimation","children":[]}]},{"level":2,"title":"Face Pipeline","slug":"face-pipeline","link":"#face-pipeline","children":[{"level":3,"title":"Execute the Face Pipeline","slug":"execute-the-face-pipeline","link":"#execute-the-face-pipeline","children":[]},{"level":3,"title":"Face RGB Anti-Spoofing","slug":"face-rgb-anti-spoofing","link":"#face-rgb-anti-spoofing","children":[]},{"level":3,"title":"Face Mask Detection","slug":"face-mask-detection","link":"#face-mask-detection","children":[]},{"level":3,"title":"Face Quality Prediction","slug":"face-quality-prediction","link":"#face-quality-prediction","children":[]},{"level":3,"title":"Eyes State Prediction","slug":"eyes-state-prediction","link":"#eyes-state-prediction","children":[]},{"level":3,"title":"Face Interactions Action Detection","slug":"face-interactions-action-detection","link":"#face-interactions-action-detection","children":[]},{"level":3,"title":"Face Emotion Prediction","slug":"face-emotion-prediction","link":"#face-emotion-prediction","children":[]},{"level":3,"title":"Face Attribute Prediction","slug":"face-attribute-prediction","link":"#face-attribute-prediction","children":[]}]},{"level":2,"title":"Face Embedding Database","slug":"face-embedding-database","link":"#face-embedding-database","children":[{"level":3,"title":"Enable/Disable FeatureHub","slug":"enable-disable-featurehub","link":"#enable-disable-featurehub","children":[]},{"level":3,"title":"Insert Face Embedding","slug":"insert-face-embedding","link":"#insert-face-embedding","children":[]},{"level":3,"title":"Search Most Similar Face","slug":"search-most-similar-face","link":"#search-most-similar-face","children":[]},{"level":3,"title":"Search Top-K Faces","slug":"search-top-k-faces","link":"#search-top-k-faces","children":[]},{"level":3,"title":"Delete Face Embedding","slug":"delete-face-embedding","link":"#delete-face-embedding","children":[]},{"level":3,"title":"Update Face Embedding","slug":"update-face-embedding","link":"#update-face-embedding","children":[]},{"level":3,"title":"Get Face Embedding from ID","slug":"get-face-embedding-from-id","link":"#get-face-embedding-from-id","children":[]},{"level":3,"title":"Dynamic Search Threshold Adjustment","slug":"dynamic-search-threshold-adjustment","link":"#dynamic-search-threshold-adjustment","children":[]},{"level":3,"title":"Database Management","slug":"database-management","link":"#database-management","children":[]}]},{"level":2,"title":"[Example]Face Detect and Pipeline","slug":"example-face-detect-and-pipeline","link":"#example-face-detect-and-pipeline","children":[]},{"level":2,"title":"[Example]Face Comparison","slug":"example-face-comparison","link":"#example-face-comparison","children":[]},{"level":2,"title":"[Example]Face Recognition with FeatureHub","slug":"example-face-recognition-with-featurehub","link":"#example-face-recognition-with-featurehub","children":[]},{"level":2,"title":"[Example]Video Face Tracking","slug":"example-video-face-tracking","link":"#example-video-face-tracking","children":[]},{"level":2,"title":"Advanced Configuration","slug":"advanced-configuration","link":"#advanced-configuration","children":[{"level":3,"title":"Session Parameters","slug":"session-parameters","link":"#session-parameters","children":[]},{"level":3,"title":"Utility Functions","slug":"utility-functions","link":"#utility-functions","children":[]},{"level":3,"title":"Image Format Support","slug":"image-format-support","link":"#image-format-support","children":[]}]}],"git":{"updatedTime":1751426354000,"contributors":[{"name":"tunm","username":"tunm","email":"tunmxy@163.com","commits":5,"url":"https://github.com/tunm"}],"changelog":[{"hash":"4f60fe37146f367d74e8a8a35abe0b3f2b4b7960","time":1751426354000,"email":"tunmxy@163.com","author":"tunm","message":"1"},{"hash":"4210a21023962524fb284ab4236a728e23ca653e","time":1744186586000,"email":"tunmxy@163.com","author":"tunm","message":"Update"},{"hash":"00473c2c94170ac17df87e27a68c633b9151a414","time":1744185861000,"email":"tunmxy@163.com","author":"tunm","message":"Update"},{"hash":"36283da830e3e7efee25add2666d4a49dae22fa8","time":1744178190000,"email":"tunmxy@163.com","author":"tunm","message":"Update"},{"hash":"b1bdfb0435ebc29849c32dd85a92e67161a23726","time":1744160796000,"email":"tunmxy@163.com","author":"tunm","message":"Update"}]},"filePathRelative":"using-with/python.md"}');export{l as comp,u as data};
