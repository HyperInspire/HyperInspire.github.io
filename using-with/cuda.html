<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.20" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="https://tunm-resource.oss-cn-hongkong.aliyuncs.com/blogs_box/favicon32.jpg"><title>Using InspireFace in CUDA | InspireFace</title><meta name="description" content="A cross-platform high-performance deep learning facial analysis SDK framework.">
    <link rel="preload" href="/assets/style-B3-VMakp.css" as="style"><link rel="stylesheet" href="/assets/style-B3-VMakp.css">
    <link rel="modulepreload" href="/assets/app-DVZq7mSN.js"><link rel="modulepreload" href="/assets/cuda.html-Nv5NAAwY.js">
    <link rel="prefetch" href="/assets/index.html-D5YEe1vT.js" as="script"><link rel="prefetch" href="/assets/feature.html-C9QlX7fg.js" as="script"><link rel="prefetch" href="/assets/get-started.html-bjdjmU37.js" as="script"><link rel="prefetch" href="/assets/introduction.html-Ar82yjxg.js" as="script"><link rel="prefetch" href="/assets/arch.html-B1YE3pc4.js" as="script"><link rel="prefetch" href="/assets/dense-landmark.html-mRgVqq3A.js" as="script"><link rel="prefetch" href="/assets/inspirecv.html-DvrjjbVd.js" as="script"><link rel="prefetch" href="/assets/android.html-DV3MJjth.js" as="script"><link rel="prefetch" href="/assets/c-cpp.html-B1C9UNk8.js" as="script"><link rel="prefetch" href="/assets/cpp.html-CWXt1CQ_.js" as="script"><link rel="prefetch" href="/assets/ios.html-CbMZS2g4.js" as="script"><link rel="prefetch" href="/assets/python.html-ByO1uf44.js" as="script"><link rel="prefetch" href="/assets/rknpu.html-CSNNPjKG.js" as="script"><link rel="prefetch" href="/assets/404.html-DDYXLehh.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="https://tunm-resource.oss-cn-hongkong.aliyuncs.com/docs/126000993.png" alt="InspireFace"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">InspireFace</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/get-started.html" aria-label="Get Started"><!--[--><!--[--><!--]--><!--]-->Get Started<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/get-started.html" aria-label="Get Started"><!--[--><!--[--><!--]--><!--]-->Get Started<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/introduction.html" aria-label="Introduction"><!--[--><!--[--><!--]--><!--]-->Introduction<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/get-started.html" aria-label="Get Started"><!--[--><!--[--><!--]--><!--]-->Get Started<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/feature.html" aria-label="Feature"><!--[--><!--[--><!--]--><!--]-->Feature<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Using with <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/using-with/c-cpp.html" aria-label="C/C++"><!--[--><!--[--><!--]--><!--]-->C/C++<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/using-with/cpp.html" aria-label="C++"><!--[--><!--[--><!--]--><!--]-->C++<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/using-with/python.html" aria-label="Python"><!--[--><!--[--><!--]--><!--]-->Python<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/using-with/android.html" aria-label="Android"><!--[--><!--[--><!--]--><!--]-->Android<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/using-with/ios.html" aria-label="iOS"><!--[--><!--[--><!--]--><!--]-->iOS<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/using-with/cuda.html" aria-label="CUDA"><!--[--><!--[--><!--]--><!--]-->CUDA<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/using-with/rknpu.html" aria-label="Rockchip NPU"><!--[--><!--[--><!--]--><!--]-->Rockchip NPU<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Guides <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/guides/arch.html" aria-label="Architecture"><!--[--><!--[--><!--]--><!--]-->Architecture<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guides/dense-landmark.html" aria-label="Dense Landmark"><!--[--><!--[--><!--]--><!--]-->Dense Landmark<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/guides/inspirecv.html" aria-label="Lightweight CV library"><!--[--><!--[--><!--]--><!--]-->Lightweight CV library<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div><h1 id="using-inspireface-in-cuda" tabindex="-1"><a class="header-anchor" href="#using-inspireface-in-cuda"><span>Using InspireFace in CUDA</span></a></h1><p>The GPU version of InspireFace has been verified on Linux physical machines. The dependency versions used for project compilation, unit testing, and continuous integration are as follows:</p><ul><li><strong>System</strong>: Ubuntu 22.04</li><li><strong>CUDA</strong>: 12.2</li><li><strong>cuDNN</strong>: 8.9.2</li><li><strong>TensorRT</strong>: 10.8.0.43</li></ul><p>The above versions were only tested on my RTX3060 12G, but this doesn&#39;t mean these are the only supported configurations. I believe as long as your environment supports TensorRT-10 and above (as of March 2025), it should run properly, since TensorRT-10 is a relatively new version, and its API seems to have some differences compared to previous versions.</p><h2 id="checking-cuda-installation" tabindex="-1"><a class="header-anchor" href="#checking-cuda-installation"><span>Checking CUDA Installation</span></a></h2><p>When using the GPU version of InspireFace, you may need to ensure your device has certain dependencies installed. Besides basic tools like GCC, CMake, Git, etc., you should mainly focus on GPU-related environments:</p><ol><li>Check CUDA installation:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">nvcc <span class="token parameter variable">-V</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If the output looks like this, then it&#39;s OK:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line">nvcc: NVIDIA <span class="token punctuation">(</span>R<span class="token punctuation">)</span> Cuda compiler driver</span>
<span class="line">Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2005</span>-2023 NVIDIA Corporation</span>
<span class="line">Built on Tue_Aug_15_22:02:13_PDT_2023</span>
<span class="line">Cuda compilation tools, release <span class="token number">12.2</span>, V12.2.140</span>
<span class="line">Build cuda_12.2.r12.2/compiler.33191640_0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Check cuDNN installation:</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">cat /usr/include/x86_64-linux-gnu/cudnn_version_v8.h | grep CUDNN_MAJOR -A 2</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If the output looks like this, then it&#39;s OK:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">#define CUDNN_MAJOR 8</span>
<span class="line">#define CUDNN_MINOR 9</span>
<span class="line">#define CUDNN_PATCHLEVEL 2</span>
<span class="line">--</span>
<span class="line">#define CUDNN_VERSION (CUDNN_MAJOR * 1000 + CUDNN_MINOR * 100 + CUDNN_PATCHLEVEL)</span>
<span class="line"></span>
<span class="line">/* cannot use constexpr here since this is a C-only file */</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Check your NVIDIA driver:</li></ol><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">nvidia-smi</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>After completing these checks, you can proceed to the next step. If there are issues, you&#39;ll need to reconfigure CUDA to ensure it can run.</p><h2 id="method-1-local-compilation" tabindex="-1"><a class="header-anchor" href="#method-1-local-compilation"><span>Method 1: Local Compilation</span></a></h2><p>Local compilation is the most complex method, but if you need to modify the InspireFace source code, this method is the most suitable for you.</p><h3 id="installing-tensorrt" tabindex="-1"><a class="header-anchor" href="#installing-tensorrt"><span>Installing TensorRT</span></a></h3><p>We recommend using TensorRT-10.8 version, as it has been verified:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># Download</span></span>
<span class="line"><span class="token function">wget</span> https://developer.nvidia.com/downloads/compute/machine-learning/tensorrt/10.8.0/tars/TensorRT-10.8.0.43.Linux.x86_64-gnu.cuda-12.8.tar.gz</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>After downloading, you need to extract it and place it anywhere. You can use the environment variable <strong>TENSORRT_ROOT</strong> to record its location.</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">export TENSORRT_ROOT=/home/tunm/software/TensorRT-10.8.0.43/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>To verify if the <strong>TensorRT</strong> installation is successful or available, you can execute the bin provided in the TensorRT folder or use some methods provided by the official website.</p><h3 id="executing-compilation" tabindex="-1"><a class="header-anchor" href="#executing-compilation"><span>Executing Compilation</span></a></h3><p>Enter the InspireFace directory, and you can directly execute the compilation command. During compilation, you need to enable some CUDA-supporting compilation switches:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token comment"># Set tensorrt root dir</span></span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">TENSORRT_ROOT</span><span class="token operator">=</span>/home/tunm/software/TensorRT-10.8.0.43/</span>
<span class="line"><span class="token comment"># Execute build</span></span>
<span class="line">cmake <span class="token punctuation">..</span> <span class="token parameter variable">-DTENSORRT_ROOT</span><span class="token operator">=</span><span class="token variable">$TENSORRT_ROOT</span> <span class="token parameter variable">-DISF_ENABLE_TENSORRT</span><span class="token operator">=</span>ON</span>
<span class="line"><span class="token function">make</span> <span class="token parameter variable">-j8</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If you encounter compilation-related errors at this step, it&#39;s likely that there&#39;s an issue when linking CUDA or TensorRT. Common problems include:</p><ul><li>Cannot find CUDA library</li><li>Cannot find TensorRT library</li><li>Incomplete CUDA library linking</li><li>CUDA library environment variable issues</li></ul><p>You can check the <strong>toolchain/FindTensorRT.cmake</strong> file in the directory, which contains the toolchain methods for how the project searches for GPU dependency libraries:</p><div class="language-cmake line-numbers-mode" data-highlighter="prismjs" data-ext="cmake"><pre><code><span class="line"><span class="token comment"># FindTensorRT.cmake - Simple Version</span></span>
<span class="line"><span class="token comment"># Contains basic functionality for finding TensorRT libraries</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Find CUDA</span></span>
<span class="line"><span class="token keyword">find_package</span><span class="token punctuation">(</span>CUDA REQUIRED<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">${</span>CUDA_INCLUDE_DIRS<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">link_directories</span><span class="token punctuation">(</span><span class="token punctuation">${</span>CUDA_TOOLKIT_ROOT_DIR<span class="token punctuation">}</span>/lib64<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Find TensorRT header files</span></span>
<span class="line"><span class="token keyword">find_path</span><span class="token punctuation">(</span>TENSORRT_INCLUDE_DIR NvInfer.h</span>
<span class="line">    HINTS <span class="token punctuation">${</span><span class="token variable">TENSORRT_ROOT</span><span class="token punctuation">}</span></span>
<span class="line">    PATH_SUFFIXES include<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Find TensorRT libraries</span></span>
<span class="line"><span class="token keyword">find_library</span><span class="token punctuation">(</span>TENSORRT_LIBRARY_INFER nvinfer</span>
<span class="line">    HINTS <span class="token punctuation">${</span><span class="token variable">TENSORRT_ROOT</span><span class="token punctuation">}</span></span>
<span class="line">    PATH_SUFFIXES lib lib64<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">find_library</span><span class="token punctuation">(</span>TENSORRT_LIBRARY_RUNTIME nvinfer_plugin</span>
<span class="line">    HINTS <span class="token punctuation">${</span><span class="token variable">TENSORRT_ROOT</span><span class="token punctuation">}</span></span>
<span class="line">    PATH_SUFFIXES lib lib64<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Find CUDA runtime library</span></span>
<span class="line"><span class="token keyword">find_library</span><span class="token punctuation">(</span>CUDA_RUNTIME_LIBRARY cudart</span>
<span class="line">    HINTS <span class="token punctuation">${</span>CUDA_TOOLKIT_ROOT_DIR<span class="token punctuation">}</span></span>
<span class="line">    PATH_SUFFIXES lib64 lib lib64/stubs lib/stubs<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Set result variables, can be used in projects that include this module</span></span>
<span class="line"><span class="token keyword">set</span><span class="token punctuation">(</span>ISF_TENSORRT_INCLUDE_DIRS <span class="token punctuation">${</span>TENSORRT_INCLUDE_DIR<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">set</span><span class="token punctuation">(</span>ISF_TENSORRT_LIBRARIES <span class="token punctuation">${</span>TENSORRT_LIBRARY_INFER<span class="token punctuation">}</span> <span class="token punctuation">${</span>TENSORRT_LIBRARY_RUNTIME<span class="token punctuation">}</span> <span class="token punctuation">${</span>CUDA_RUNTIME_LIBRARY<span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Output status messages</span></span>
<span class="line"><span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">&quot;Found TensorRT include: <span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">TENSORRT_INCLUDE_DIR</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">&quot;Found TensorRT libraries: <span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">TENSORRT_LIBRARY_INFER</span><span class="token punctuation">}</span></span> <span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">TENSORRT_LIBRARY_RUNTIME</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">message</span><span class="token punctuation">(</span>STATUS <span class="token string">&quot;Found CUDA runtime library: <span class="token interpolation"><span class="token punctuation">${</span><span class="token variable">CUDA_RUNTIME_LIBRARY</span><span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="compilation-completion" tabindex="-1"><a class="header-anchor" href="#compilation-completion"><span>Compilation Completion</span></a></h3><p>When you successfully compile, you can see directories like lib, test, and sample, and find dynamic libraries, test programs, and sample programs from them.</p><h2 id="method-2-using-docker-for-compilation" tabindex="-1"><a class="header-anchor" href="#method-2-using-docker-for-compilation"><span>Method 2: Using Docker for Compilation</span></a></h2><p>Using Docker for compilation is the simplest method. You only need to ensure that you have installed <strong>docker</strong> and <strong>docker-compose</strong>. If your host machine only needs to compile libraries and doesn&#39;t need to deploy GPU projects, you may not even need to install a CUDA environment.</p><p>Note that using Docker for compilation has limitations in terms of version selection, such as system and CUDA versions. If you need to modify them, you can check the dockerfile in the project root directory.</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token function">docker-compose</span> up build-tensorrt-cuda12-ubuntu22</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="method-3-directly-download-pre-compiled-libraries" tabindex="-1"><a class="header-anchor" href="#method-3-directly-download-pre-compiled-libraries"><span>Method 3: Directly Download Pre-compiled Libraries</span></a></h2><p>This is the simplest method, but it is for fixed system versions and CUDA versions. You can go directly to the <a href="https://github.com/HyperInspire/InspireFace/releases" target="_blank" rel="noopener noreferrer">Release Page</a> to find pre-compiled CUDA version SDKs.</p><h2 id="how-to-use-the-library" tabindex="-1"><a class="header-anchor" href="#how-to-use-the-library"><span>How to Use the Library</span></a></h2><p>Let&#39;s describe how to use CMake to build a simple example using the CUDA version of InspireFace.</p><p>For convenience, along with the dynamic library, we need to put <strong>toolchain/FindTensorRT.cmake</strong> and the <strong>Megatron_TRT</strong> model into the project:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code><span class="line"><span class="token builtin class-name">.</span></span>
<span class="line">├── CMakeLists.txt</span>
<span class="line">├── FindTensorRT.cmake</span>
<span class="line">├── InspireFace</span>
<span class="line">│   ├── include</span>
<span class="line">│   │   ├── herror.h</span>
<span class="line">│   │   ├── inspireface.h</span>
<span class="line">│   │   └── intypedef.h</span>
<span class="line">│   └── lib</span>
<span class="line">│       └── libInspireFace.so</span>
<span class="line">├── main.cpp</span>
<span class="line">└── models</span>
<span class="line">    └── Megatron_TRT</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can refer to this for building <strong>CMakeLists.txt</strong>:</p><div class="language-cmake line-numbers-mode" data-highlighter="prismjs" data-ext="cmake"><pre><code><span class="line"><span class="token keyword">project</span><span class="token punctuation">(</span>InspireFaceCUDA<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token variable">CMAKE_CXX_STANDARD</span> <span class="token number">14</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Add the current directory to the CMake module path</span></span>
<span class="line"><span class="token keyword">list</span><span class="token punctuation">(</span>APPEND <span class="token variable">CMAKE_MODULE_PATH</span> <span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span>/<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Find TensorRT</span></span>
<span class="line"><span class="token keyword">include</span><span class="token punctuation">(</span>FindTensorRT<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Link InspireFace </span></span>
<span class="line"><span class="token keyword">link_directories</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span>/InspireFace/lib<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Include InspireFace headers</span></span>
<span class="line"><span class="token keyword">include_directories</span><span class="token punctuation">(</span><span class="token punctuation">${</span><span class="token variable">CMAKE_CURRENT_SOURCE_DIR</span><span class="token punctuation">}</span>/InspireFace/include<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">add_executable</span><span class="token punctuation">(</span>demo main.cpp<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">target_link_libraries</span><span class="token punctuation">(</span>demo <span class="token punctuation">${</span>TENSORRT_LIBRARIES<span class="token punctuation">}</span> InspireFace<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Besides building, the InspireFace CAPI provides some CUDA-related interfaces, mainly utility functions for printing GPU information, checking availability, etc. Other facial algorithm functionality interfaces <strong>are consistent with the general version</strong>, so we won&#39;t elaborate on how to use the API.</p><div class="language-c line-numbers-mode" data-highlighter="prismjs" data-ext="c"><pre><code><span class="line"><span class="token comment">/**</span>
<span class="line"> * @brief Set the Apple CoreML inference mode, must be called before HFCreateInspireFaceSession.</span>
<span class="line"> * @param mode The inference mode to be set.</span>
<span class="line"> * @return HResult indicating the success or failure of the operation.</span>
<span class="line"> * */</span></span>
<span class="line">HYPER_CAPI_EXPORT <span class="token keyword">extern</span> HResult <span class="token function">HFSetAppleCoreMLInferenceMode</span><span class="token punctuation">(</span>HFAppleCoreMLInferenceMode mode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/**</span>
<span class="line"> * @brief Set the CUDA device id, must be called before HFCreateInspireFaceSession.</span>
<span class="line"> * @param device_id The device id to be set.</span>
<span class="line"> * @return HResult indicating the success or failure of the operation.</span>
<span class="line"> * */</span></span>
<span class="line">HYPER_CAPI_EXPORT <span class="token keyword">extern</span> HResult <span class="token function">HFSetCudaDeviceId</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> device_id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/**</span>
<span class="line"> * @brief Get the CUDA device id, must be called after HFCreateInspireFaceSession.</span>
<span class="line"> * @param device_id Pointer to the device id to be returned.</span>
<span class="line"> * @return HResult indicating the success or failure of the operation.</span>
<span class="line"> * */</span></span>
<span class="line">HYPER_CAPI_EXPORT <span class="token keyword">extern</span> HResult <span class="token function">HFGetCudaDeviceId</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> <span class="token operator">*</span>device_id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/**</span>
<span class="line"> * @brief Print the CUDA device information.</span>
<span class="line"> * @return HResult indicating the success or failure of the operation.</span>
<span class="line"> * */</span></span>
<span class="line">HYPER_CAPI_EXPORT <span class="token keyword">extern</span> HResult <span class="token function">HFPrintCudaDeviceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/**</span>
<span class="line"> * @brief Get the number of CUDA devices.</span>
<span class="line"> * @param num_devices Pointer to the number of CUDA devices to be returned.</span>
<span class="line"> * @return HResult indicating the success or failure of the operation.</span>
<span class="line"> * */</span></span>
<span class="line">HYPER_CAPI_EXPORT <span class="token keyword">extern</span> HResult <span class="token function">HFGetNumCudaDevices</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> <span class="token operator">*</span>num_devices<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">/**</span>
<span class="line"> * @brief Check if the CUDA device is supported.</span>
<span class="line"> * @param support The support flag to be checked.</span>
<span class="line"> * @return HResult indicating the success or failure of the operation.</span>
<span class="line"> * */</span></span>
<span class="line">HYPER_CAPI_EXPORT <span class="token keyword">extern</span> HResult <span class="token function">HFCheckCudaDeviceSupport</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> <span class="token operator">*</span>is_support<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated:: </span><time class="meta-item-info" datetime="2025-04-10T14:54:42.000Z" data-allow-mismatch>4/10/25, 2:54 PM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: tunmxy@163.com">tunm</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: tunmxy@163.com">Jingyu</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/using-with/ios.html" aria-label="iOS"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">iOS</span></div><!--]--></a><a class="route-link auto-link next" href="/using-with/rknpu.html" aria-label="Rockchip NPU"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Rockchip NPU</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DVZq7mSN.js" defer></script>
  </body>
</html>
